<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Interactive asteroid impact simulator - NASA Space Apps Challenge 2025">
    <link rel="manifest" href="manifest.json">
    <title>METEOR MADNESS - NASA Space Apps Challenge 2025</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="libs/leaflet/leaflet.css" />
</head>
<body>
    <div id="loading-screen">
        <div class="loader"></div>
        <p>Loading NASA NeoWs API data...</p>
    </div>

    <div id="ui-container">
        <div id="left-panel" class="panel">
            <div class="header">
                <h1>‚òÑÔ∏è METEOR MADNESS</h1>
                <p style="font-size: 12px; color: #ff6b35; margin-top: 5px;">üèÜ NASA Space Apps Challenge 2025</p>
            </div>

            <div class="section">
                <h2>üåå Select Asteroid</h2>
                <select id="asteroid-select" style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); border: 1px solid #444; border-radius: 6px; color: white; font-size: 14px; cursor: pointer; margin-bottom: 10px;">
                    <option value="">Loading asteroids...</option>
                </select>
                <button id="load-more-asteroids" class="btn-secondary" style="display: none; margin-top: 10px;">
                    üì• Load More Asteroids
                </button>
            </div>

            <div class="section" id="asteroid-info" style="display: none;">
                <h2>üìä Asteroid Information</h2>
                <div id="asteroid-details"></div>
            </div>

            <div class="section">
                <h2>üìç Impact Location</h2>
                <p class="instruction">Click on the map or enter coordinates:</p>
                
                <div class="coordinate-inputs" style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <div style="flex: 1;">
                        <label style="font-size: 12px; color: #aaa;">Latitude (-90 to 90)</label>
                        <input type="number" id="lat-input" min="-90" max="90" step="0.01" value="0" 
                               style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid #444; border-radius: 4px; color: white;"
                               inputmode="decimal">
                    </div>
                    <div style="flex: 1;">
                        <label style="font-size: 12px; color: #aaa;">Longitude (-180 to 180)</label>
                        <input type="number" id="lng-input" min="-180" max="180" step="0.01" value="0"
                               style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid #444; border-radius: 4px; color: white;"
                               inputmode="decimal">
                    </div>
                </div>
                
                <button id="set-coordinates" class="btn-secondary" style="margin-bottom: 10px;">
                    üìç Set Coordinates
                </button>
                
                <div id="coordinates">
                    <span>Latitude: <strong id="lat">0¬∞</strong></span>
                    <span>Longitude: <strong id="lng">0¬∞</strong></span>
                </div>
                <div style="position: relative;">
                    <div id="map" style="height: 250px; margin-top: 10px; border-radius: 8px; overflow: hidden;"></div>
                    <!-- Expand/collapse button in corner -->
                    <button id="map-expand-btn" class="map-expand-btn" title="Expand Map">‚õ∂</button>
                </div>
            </div>

            <div class="section">
                <button id="toggle-visualization" class="btn-visualization">
                    üî• Fall Visualization: OFF
                </button>
                <button id="start-simulation" class="btn-primary" disabled>
                    üöÄ Start Simulation
                </button>
                <button id="reset-simulation" class="btn-secondary">
                    üîÑ Reset
                </button>
            </div>

            <div class="section" id="impact-info" style="display: none;">
                <h2>‚ö†Ô∏è Impact Parameters</h2>
                <div id="impact-details"></div>
            </div>

            <div class="section" id="realtime-data" style="display: none;">
                <h2>üìä Real-Time Data</h2>
                <div id="realtime-content" style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 6px;">
                </div>
            </div>

            <div class="section" id="impact-consequences" style="display: none;">
                <h2>‚ò†Ô∏è Impact Consequences</h2>
                <div id="consequences-data" style="background: rgba(255,50,50,0.1); padding: 12px; border-radius: 6px; border: 2px solid rgba(255,50,50,0.3);">
                </div>
            </div>

            <div class="section" id="historical-comparison" style="display: none;">
                <h2>üìö Historical Events</h2>
                <div id="historical-data" style="background: rgba(100,150,255,0.1); padding: 12px; border-radius: 6px; border: 2px solid rgba(100,150,255,0.3);">
                </div>
            </div>

            <div class="section" id="planetary-defense" style="display: none;">
                <h2>üõ°Ô∏è Planetary Defense</h2>
                <div id="defense-data" style="background: rgba(50,255,100,0.1); padding: 12px; border-radius: 6px; border: 2px solid rgba(50,255,100,0.3);">
                </div>
            </div>
        </div>
    </div>

    <div id="canvas-container"></div>

    <!-- Fullscreen Map Overlay -->
    <div class="map-fullscreen-overlay" id="map-fullscreen-overlay">
        <div class="map-fullscreen-container">
            <div class="map-fullscreen-header">
                <div class="map-fullscreen-title">üó∫Ô∏è Select Impact Location</div>
                <button class="map-fullscreen-close" id="map-fullscreen-close">‚úï</button>
            </div>
            <div class="map-fullscreen-content">
                <div id="map-fullscreen"></div>
            </div>
        </div>
    </div>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ - –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–º–∏ -->
    <script src="libs/three/three.min.js"></script>
    <script src="libs/three/OrbitControls.js"></script>
    <script src="libs/leaflet/leaflet.js"></script>
    
    <script>
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É—Ç–µ–π –¥–ª—è –∏–∫–æ–Ω–æ–∫ Leaflet
        if (typeof L !== 'undefined') {
            L.Icon.Default.imagePath = 'libs/leaflet/';
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            if (typeof L === 'undefined') {
                console.error('Leaflet –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                return;
            }
            
            // Small map in panel
            window.map = L.map('map').setView([0, 0], 2);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(window.map);
            
            window.mapInitialized = true;
            
            window.map.on('click', function(e) {
                if (window.setImpactLocation) {
                    window.setImpactLocation(e.latlng.lat, e.latlng.lng);
                }
            });
            
            // Fullscreen map
            window.mapFullscreen = L.map('map-fullscreen').setView([0, 0], 2);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(window.mapFullscreen);
            
            window.mapFullscreen.on('click', function(e) {
                if (window.setImpactLocation) {
                    window.setImpactLocation(e.latlng.lat, e.latlng.lng);
                    // DON'T auto-close - user must click close button
                }
            });
            
            // Map expand button - opens fullscreen
            const expandBtn = document.getElementById('map-expand-btn');
            const overlay = document.getElementById('map-fullscreen-overlay');
            const closeBtn = document.getElementById('map-fullscreen-close');
            
            function openFullscreenMap() {
                overlay.classList.add('active');
                setTimeout(() => {
                    window.mapFullscreen.invalidateSize();
                    // Sync view with small map
                    const center = window.map.getCenter();
                    const zoom = window.map.getZoom();
                    window.mapFullscreen.setView(center, zoom);
                }, 100);
            }
            
            function closeFullscreenMap() {
                overlay.classList.remove('active');
            }
            
            expandBtn.addEventListener('click', openFullscreenMap);
            closeBtn.addEventListener('click', closeFullscreenMap);
            
            // Close on Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && overlay.classList.contains('active')) {
                    closeFullscreenMap();
                }
            });
            
            // Close on background click
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    closeFullscreenMap();
                }
            });
        });
    </script>
    
    <!-- Modules - versioned to prevent caching -->
    <script src="js/mobile.js?v=19"></script>
    <script src="js/config.js?v=18"></script>
    <script src="js/scene.js?v=18"></script>
    <script src="js/particles.js?v=18"></script>
    <script src="js/explosion.js?v=18"></script>
    <script src="js/nasa.js?v=18"></script>
    <script src="js/controls.js?v=18"></script>
    <script src="js/simulation.js?v=18"></script>
    <script src="js/init.js?v=18"></script>
</body>
</html>
